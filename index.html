<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>The S3 Log Analyser</title>
    <!-- CSS Libraries -->
    <link rel="stylesheet" href="./lib/css/bootstrap.min.css" />
    <link rel="stylesheet" href="./lib/css/dc.min.css" />
    <link rel="stylesheet" href="./lib/css/fontawesome.min.css" />
    <!-- App CSS -->
    <link rel="stylesheet" href="./styles/main.css" />
    <!-- JS Libraries -->
    <script defer src="./lib/js/jquery-3.4.1.min.js"></script>
    <script defer src="./lib/js/bootstrap.bundle.min.js"></script>
    <script defer src="./lib/js/aws-sdk-2.461.0.min.js"></script>
    <script defer src="./lib/js/d3.min.js"></script>
    <script defer src="./lib/js/crossfilter.min.js"></script>
    <script defer src="./lib/js/dc.min.js"></script>
    <!-- App JS -->
    <script defer src="./scripts/forms.js"></script>
    <script defer src="./scripts/aws.js"></script>
    <script defer src="./scripts/filters.js"></script>
    <script defer src="./scripts/errors.js"></script>
    <script defer src="./scripts/charts.js"></script>
</head>
<body>
    <div id="app-container" class="container-fluid">
        <!-- Site Header -->
        <header class="row fixed-top align-items-center text-center flex-nowrap">
            <div class="col">Logo1</div>
            <h1 class="col-8">The S3 Log Analyser</h1>
            <div class="col">Logo2</div>
        </header>
        <!-- Intro Text -->
        <div class="row card m-3">
            <div class="card-body">
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Cumque ad, dignissimos in, fugiat nisi corporis iusto, saepe quasi impedit tempora ab? At voluptates quod aperiam quos officia ullam harum doloremque! Vero possimus accusamus saepe qui iste commodi et aspernatur aliquam aliquid fugit, quos vel voluptates non dolore. Voluptatum, esse amet.</p>
            </div>
        </div>
        <!-- Helper Graphics -->
        <div class="row">
            <div class="col-12 col-lg-5 text-center">
                <i class="fas fa-arrow-circle-down"></i> Start Here
            </div>
        </div>
        <!-- App Setup -->
        <div class="row justify-content-around">
            <!-- API Credentials Section -->
            <section id="section-api-creds" class="col-11 col-lg-5 m-2 py-2 rounded highlight-form">                
                <h2 class="text-center">Connect to an S3 Bucket</h2>
                <div class="row align-items-center">
                    <div class="col-md-9 text-center text-md-left">
                        <p>Enter you AWS credentials below (or load some saved ones if you have been here before). You will need to have read access to an S3 bucket, take a look at the help for
                            more information. Credentials are <u>never</u> transmitted to our servers, saved credentials are stored in your browser.</p>
                    </div>
                    <div class="col-md-3 text-center mb-3">
                        <button type="button" class="btn btn-info btn-lg rounded-circle" data-toggle="modal" data-target="#modal-help">Help..</button>
                    </div>
                </div>
                <!-- Load Saved Credentials Buttons -->     
                <div id="buttons-load-saved">
                    <div class="btn-group" id="buttons-load-local-saved" role="group">
                        <button type="button" class="btn btn-secondary" onclick="loadSavedCreds();" disabled>Load Saved</button>
                        <button type="button" class="btn btn-danger" onclick="clearSavedCreds();" disabled><small>Clear</small></button>                         
                    </div>
                    <button class="btn btn-warning float-right" onclick="loadDemoCredentials();">Use DEMO Creds</button>
                </div>                                             
                <!-- Enter AWS Credentials Form -->
                <form id="form-api-creds" class="mt-3" onsubmit="return submitCredsForm(this);">
                    <div class="form-group">                            
                        <input type="text" class="form-control form-control-lg" id="access-key-id" name="keyId" aria-describedby="key-id-help" placeholder="Access Key ID" required>
                        <small id="key-id-help" class="form-text text-muted">Your AWS API Key ID</small>
                    </div>
                    <div class="form-group">                            
                        <input type="password" class="form-control form-control-lg" id="access-key-secret" name="keySecret" aria-describedby="secret-help" placeholder="Secret" required>
                        <small id="secret-help" class="form-text text-muted">The key's secret</small>
                    </div>
                    <div class="form-row">
                        <div class="col">                                
                            <select class="form-control" id="aws-region-select" name="awsRegion" aria-describedby="aws-region-help" required>
                                <!-- Options added by JS -->
                            </select>
                            <small id="aws-region-help" class="form-text text-muted">Region in which your S3 bucket is hosted.</small>
                        </div>
                        <div class="col">
                            <input type="text" class="form-control" id="bucket-name" name="bucketName" aria-describedby="bucket-name-help" placeholder="Bucket Name" required>
                            <small id="bucket-name-help" class="form-text text-muted">Name of the bucket containing the log files.</small>
                        </div>                            
                    </div>
                    <div class="row align-items-center">
                        <div class="col">                        
                            <button type="submit" class="btn btn-outline-success btn-sm my-3" onclick="saveCredsFlag = false;">Connect without saving credentials in browser</button> 
                        </div>
                        <div class="col text-right">
                            <button type="submit" class="btn btn-success btn-lg my-3" onclick="saveCredsFlag = true;">Connect</button>
                        </div>
                    </div>                                        
                </form>                                                                                                             
            </section>
            <!-- API Connect Message Area -->
            <div id="message-area-api-connect" class="col col-lg-1 my-2 text-center px-0">                                           
                <div id="message-area-api-connect-loading" class="py-3">
                    <div class="spinner-border" role="status"></div>     
                    <!-- JS -->
                </div>
                <table id="table-object-count" class="table table-sm table-bordered py-2">
                    <tr>
                        <td>Objects</td>
                        <td id="message-area-api-connect-counter">0<!-- JS --></td>
                    </tr>
                </table>
                <table id="table-object-stats" class="table table-sm table-bordered py-2">
                    <thead class="thead-dark">
                        <tr>
                            <th colspan="2"><strong>Log Types</strong></th>
                        </tr>     
                    </thead>
                    <tr>
                        <td>S3</td>
                        <td id="message-area-api-connect-other-count">-<!-- JS --></td>
                    </tr>
                    <tr>
                        <td>CloudFront</td>
                        <td id="message-area-api-connect-gz-count">-<!-- JS --></td>
                    </tr>
                    <tr>
                        <td><i>Ignored</i></td>
                        <td id="message-area-api-connect-removed-count">-<!-- JS --></td>
                    </tr>                   
                </table>               
                <div id="instruction-select-filter" class="py-3">
                    <i class="fas fa-arrow-circle-right"></i><br>
                    Now Select By Date
                </div>                                
            </div>           
            <!-- Filter Log Files Section -->
            <section id="section-filter-logs" class="col-11 col-lg-5 m-2 py-2 rounded">                                                        
                <div class="text-center">
                    <h2>Filter Log Files</h2>
                    <small>Select the type of log files to visualise</small>
                </div>                               
                <!-- Filter Log Files Form -->
                <form id="form-filter-log-files" onsubmit="return submitFilterForm();">
                    <fieldset id="fieldset-log-file-type" class="form-group border p-2 text-center">
                        <legend class="text-left">Select Log Type</legend>
                        <div class="custom-control custom-radio custom-control-inline">
                            <input class="custom-control-input" type="radio" name="log-file-type" id="type-s3-log-file" value="s3Log" onclick="filterListByType('S3Log');" required disabled>
                            <label class="custom-control-label" for="type-s3-log-file">S3 Access Log (.txt)</label>
                        </div>
                        <div class="custom-control custom-radio custom-control-inline">
                            <input class="custom-control-input" type="radio" name="log-file-type" id="type-cloudfront-log-file" value="cfLog" onclick="filterListByType('CloudFront');" required disabled>
                            <label class="custom-control-label" for="type-cloudfront-log-file">CloudFront Access Log (.gz)</label>
                        </div>
                    </fieldset>
                    <div class="row justify-content-center text-center">
                        <div id="arrow-left" class="col-2"><i class="fas fa-chevron-circle-down"></i></div>
                        <div class="col-1">OR</div>
                        <div id="arrow-right" class="col-2"><i class="fas fa-chevron-circle-down"></i></div>
                    </div>
                    <div class="row">
                        <fieldset id="fieldset-log-file-date" class="col form-group border mx-2">
                            <legend>Filter By Date</legend>
                            <div class="form-group">
                                <label class="form-text text-muted" for="date-min">From:</label>
                                <input class="form-control" type="date" name="date-min" id="date-min" min="" max="" oninput="filterListByDate();" disabled>
                                <p class="text-right"><small >Earliest: <span id="info-date-min"><!-- JS Inserts --></span></small></p> 
                            </div>
                            <div class="form-group">
                                <label class="form-text text-muted" for="date-max">To:</label>                                                    
                                <input class="form-control" type="date" name="date-max" id="date-max" min="" max="" oninput="filterListByDate();" disabled>
                                <p class="text-right"><small >Latest: <span id="info-date-max"><!-- JS Inserts --></span></small></p> 
                            </div>                                                   
                        </fieldset>
                        <fieldset class="col form-group border mx-2">
                            <legend>Preset Filters</legend>
                            <div class="space-vertically ml-3">
                               <div class="vertically-spaced-item custom-control custom-radio py-1">
                                    <input class="custom-control-input" type="radio" name="preset-filter" id="filter1" value="filter1" disabled>
                                    <label class="custom-control-label" for="filter1">filter1</label>
                                </div>
                                <div class="vertically-spaced-item custom-control custom-radio py-1">
                                    <input class="custom-control-input" type="radio" name="preset-filter" id="filter2" value="filter2" disabled>
                                    <label class="custom-control-label" for="filter2">filter2</label>
                                </div>
                                <div class="vertically-spaced-item custom-control custom-radio py-1">
                                    <input class="custom-control-input" type="radio" name="preset-filter" id="filter3" value="filter3" disabled>
                                    <label class="custom-control-label" for="filter3">filter3</label>
                                </div>
                                <div class="vertically-spaced-item custom-control custom-radio py-1">
                                    <input class="custom-control-input" type="radio" name="preset-filter" id="filter4" value="filter4" disabled>
                                    <label class="custom-control-label" for="filter4">filter4</label>
                                </div>                                
                            </div>                            
                        </fieldset>
                    </div>
                    <div class="row align-items-center justify-content-between">
                        <div class="col-5">
                            <table id="table-object-count" class="table table-sm table-bordered">
                                <tr>
                                    <td class="text-right">Number of log files selected:</td>
                                    <td id="info-num-files-selected" class="align-middle"><!-- JS --></td>
                                </tr>
                            </table>                            
                        </div>
                        <div class="col-4 text-right">                        
                            <button type="" id="button-submit-filter-form" class="btn btn-success btn-lg" onclick="return submitFilterForm();" disabled>Load & Display</button>                            
                        </div>
                    </div>                
                </form>                
            </section>            
        </div>
        <!-- Load Logs Message Area -->
        <div id="message-area-load-logs" class="row align-items-center my-3">                                        
            <div id="message-area-load-logs-loading" class="col align-middle">
                <span class="spinner-border mr-2" role="status"></span><!--JS-->
            </div>
            <div class="col text-center">
                Logs Loaded: <span id="message-area-load-logs-counter">0<!-- JS --></span>
            </div>
            <div class="col text-right">
                <button type="button" class="btn btn-warning" onclick="changeFilters();">Change Filter</button>
            </div>            
        </div>        
        <!-- Visualised Data Section-->
        <section id="section-visualise-data" class="row">            
            <div id="heading-no-data" class="col text-center mt-3">                
                <p><span class="badge badge-info m-2">Chart Area</span>Nothing to show, use controls above to load some data <i class="fas fa-arrow-up"></i></p>
            </div>
            <!-- Chart Intro Text -->
            <article class="row card m-3">
                <div class="card-body">
                    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Cumque ad, dignissimos in, fugiat nisi corporis iusto, saepe quasi impedit tempora ab? At voluptates quod aperiam quos officia ullam harum doloremque! Vero possimus accusamus saepe qui iste commodi et aspernatur aliquam aliquid fugit, quos vel voluptates non dolore. Voluptatum, esse amet.</p>
                </div>
            </article>
            <article id="chart-requests-over-time" class="col-12 chart">                
                <h2>Requests Over Time (per day)</h2>
                <!-- DC Chart Here -->
            </article>
            <article id="chart-requests-by-type" class="col-md-4 chart">                
                <h2>Method</h2>
                <!-- DC Chart Here -->
            </article>
            <article id="chart-requests-by-user-agent" class="col-md-4 chart">                
                <h2>User Agent</h2>
                <!-- DC Chart Here -->
            </article>
            <article id="chart-response-by-http-status" class="col-md-4 chart">                
                <h2>HTTP Status Code</h2>
                <!-- DC Chart Here -->
            </article>
            <article id="chart-bytes-sent-over-time" class="col-12 chart">                
                <h2>Bytes Sent Over Time (per day)</h2>
                <!-- DC Chart Here -->
            </article>
            <article id="chart-requests-by-protocol" class="col-md-4 chart">                
                <h2>HTTP/HTTPS</h2>
                <!-- DC Chart Here -->
            </article>
            <article id="" class="col-md-4 chart">                
                <h2>Top 10 URLs</h2>
                <table id="leaderboard-files-by-count" class="table table-striped table-bordered text-center"><!-- DC Table Here --></table>
            </article>
            <article id="" class="col-md-4 chart">                
                <h2>Slowest 10 Requests by Processing Time</h2>
                <table id="leaderboard-files-by-time" class="table table-striped table-bordered text-center"><!-- DC Table Here --></table>
            </article>
        </section>
        <!-- Site Footer -->
        <footer class="row justify-content-center align-items-center">
            <div class="col-10">
                <div class="row justify-content-center my-2">
                    <div class="col col-4">                                               
                        <button type="reset" class="btn btn-danger" onclick="resetPage();">RESET</button>
                    </div>
                    <div class="col col-4">
                        <button id="button-change-filter-footer" type="button" class="btn btn-warning" onclick="changeFilters();">Change Filter</button>
                    </div>
                </div>
            </div>            
            <div class="col-11 col-md-2 text-center">
                &copy; David Bland 2019
            </div>            
        </footer>       
    </div>
    <!-- MODALS -->
    <!-- Error Modal -->
    <div class="modal fade" id="modal-error-messages" tabindex="-1" role="dialog" aria-labelledby="error-modal-title" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="error-modal-title">Some Errors Occured</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div id="modal-error-message-area" class="modal-body">
                    <!-- Eror message content via JS -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" id="button-error-modal-continue" data-dismiss="modal" onclick="">Continue</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal" onclick="errorModalGoBack();">Go Back</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Help Modal -->
    <div class="modal fade" id="modal-help" tabindex="-1" role="dialog" aria-labelledby="help-modal-title" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="help-modal-title">Help</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div id="modal-help" class="modal-body">
                    Help content here...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>